<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vibe Landing Zone ‚Äî Max Vibe Edition</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
<link id="favicon" rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=" />

<!-- CodeMirror 6 (no build step) -->
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/@codemirror/basic-setup@0.20.0/dist/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@codemirror/view@6.26.3/dist/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@codemirror/state@6.4.0/dist/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-html@6.4.9/dist/index.min.js"></script>

<!-- Tone.js for Ambient Sound -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
<style>
  :root { --hue: 220; --fg: #e5e7eb; --bg: #000; --glow-intensity: 1.0; }
  * { box-sizing: border-box; }
  html, body { height: 100%; margin: 0; }
  body { background: var(--bg); color: var(--fg); overflow: hidden; font-family: "IBM Plex Sans", system-ui; }
  body.dragging-editor, body.dragging-dock { cursor: grabbing !important; user-select: none; }

  #bg, #particles { position: fixed; inset: 0; width: 100%; height: 100%; display: block;
      filter: brightness(calc(1 + (var(--glow-intensity) - 1) * 0.5)) saturate(calc(1 + (var(--glow-intensity) - 1) * 0.2));
      will-change: filter; }
  #bg     { z-index: 0; }
  #particles { z-index: 1; pointer-events: none; }

  #editor {
    position: fixed; top: 7vh; left: 6vw;
    min-height: 40vh; z-index: 4; overflow: hidden;
    background: rgba(10,12,18,0.75); border: 1px solid rgba(147,197,253,0.15);
    border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.45), 0 0 40px hsla(var(--hue),90%,60%,0.22) inset;
    transition: opacity .35s ease, transform .35s ease; cursor: default;
    width: calc(100vw - 12vw);
   }
  #editor-title { display: flex; align-items: center; gap: .6rem; padding: .8rem 1rem; font-weight: 600;
    background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0));
    border-bottom: 1px solid rgba(147,197,253,0.15); cursor: grab; position: relative; }
  body.dragging-editor #editor-title { cursor: grabbing; }
  #liteBadge { position:absolute; right:10px; top:10px; font-size:.75rem; color:#a7f3d0; background:rgba(0,0,0,0.5); border:1px solid rgba(167,243,208,0.35); padding:.25rem .5rem; border-radius:8px; }

  .dot { width: .7rem; height: .7rem; border-radius: 50%; }
  #codeHost { width: 100%; min-height: 36vh; border: 0; background: #0b0d14; color: #c7d2fe; }
  #actions { display: flex; justify-content: flex-end; align-items: center; padding: .8rem 1rem 1rem; gap: 0.5rem; }

  .secondary-btn {
    background: rgba(var(--hue), 90%, 60%, 0.1); border: 1px solid hsla(var(--hue), 90%, 60%, 0.3);
    color: hsl(var(--hue), 90%, 80%); padding: .5rem .9rem; border-radius: 9999px; font-size: 0.8rem;
    font-weight: 600; cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
  }
  .secondary-btn:hover { background: hsla(var(--hue), 90%, 60%, 0.2); border-color: hsla(var(--hue), 90%, 60%, 0.5); }
  .secondary-btn.copied { background: hsla(120, 70%, 50%, 0.2); border-color: hsla(120, 70%, 50%, 0.5); color: hsl(120, 70%, 80%); }

  .btn { appearance: none; border: none; outline: none; cursor: pointer; border-radius: 9999px;
    padding: .7rem 1.3rem; color: white; font-weight: 800; letter-spacing: .02em;
    background: linear-gradient(135deg, hsl(var(--hue),90%,60%), hsl(calc(var(--hue)+60),80%,55%));
    box-shadow: 0 0 20px hsla(var(--hue),90%,60%,.4), 0 0 40px hsla(var(--hue),90%,60%,.2);
    transition: all .25s ease, transform .2s ease; }
  .btn:disabled { background: #555; cursor: not-allowed; opacity: 0.7; box-shadow: none; }
  .btn:hover:not(:disabled) { transform: translateY(-2px); filter: brightness(1.1); box-shadow: 0 0 40px hsla(var(--hue),90%,70%,.5); }

  #preview { position: fixed; inset: 0; width: 100%; height: 100%; border: 0; background: transparent; z-index: 3; }
  .hidden { display: none !important; opacity: 0 !important; pointer-events: none !important; transform: scale(0.98) !important; }

  #remix { position: fixed; bottom: 28vh; right: 2.8vw; z-index: 10; display: none;
    background: hsla(var(--hue), 80%, 55%, 0.4); backdrop-filter: blur(5px);
    border: 1px solid hsla(var(--hue), 80%, 60%, 0.6);
    box-shadow: 0 0 calc(30px * var(--glow-intensity)) hsla(var(--hue), 80%, 60%, 0.5);
    animation: pulseGlow 2.5s infinite ease-in-out; }
  @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 calc(30px * var(--glow-intensity)) hsla(var(--hue), 80%, 60%, 0.5); transform: scale(1); }
    50% { box-shadow: 0 0 calc(45px * var(--glow-intensity)) hsla(var(--hue), 80%, 65%, 0.7); transform: scale(1.02); } }

  #orb { position: fixed; right: 22px; bottom: 22px; z-index: 5; transition: opacity .3s ease, transform .3s ease, filter 0.3s ease; }
  body.dragging-editor #orb { filter: opacity(0.4); pointer-events: none; }
  #orbCore { width: 128px; height: 128px; border-radius: 50%; display: flex; flex-direction: column; gap: .35rem; align-items: center; justify-content: center; background: radial-gradient(120px 120px at 50% 30%, hsla(var(--hue),70%,60%,.28), rgba(15,18,26,.65)); border: 1px solid hsla(var(--hue),80%,60%,.4); box-shadow: 0 0 calc(40px * var(--glow-intensity)) hsla(var(--hue),80%,60%,.35), inset 0 0 40px hsla(var(--hue),80%,60%,.12); }
  #orbLabel { font-size: .68rem; opacity: .85; letter-spacing: .08em; text-transform: uppercase; }
  #hue { width: 92px; }

  #dock {
    position: fixed; right: 22px; bottom: 164px; display: grid; gap: 10px; padding: 10px 12px; border-radius: 14px;
    background: rgba(8,10,16,0.92); border: 1px solid rgba(147,197,253,0.18);
    box-shadow: 0 20px 60px rgba(0,0,0,0.45), 0 0 calc(28px * var(--glow-intensity)) hsla(var(--hue),90%,60%,.22) inset; z-index: 6;
    transition: opacity .3s ease, transform .3s ease, filter 0.3s ease; cursor: grab; }
  body.dragging-editor #dock { filter: opacity(0.4); pointer-events: none; }
  body.dragging-dock #dock { cursor: grabbing; }

  .row { display: flex; align-items: center; gap: 8px; }
  .emo { width: 20px; text-align: center; font-size: 1.1em; }
  .slider { appearance: none; height: 8px; width: 160px; background: rgba(147,197,253,0.18); border-radius: 9999px; cursor: pointer; }
  .slider::-webkit-slider-thumb { appearance: none; width: 18px; height: 18px; border-radius: 50%; background: hsl(var(--hue),90%,60%); border: 2px solid rgba(20,20,30,0.9); box-shadow: 0 0 calc(12px * var(--glow-intensity)) hsla(var(--hue),90%,60%,.6); }
  .toggle { appearance: none; width: 42px; height: 26px; border-radius: 9999px; position: relative; background: rgba(147,197,253,0.18); border: 1px solid rgba(147,197,253,0.25); cursor: pointer; }
  .toggle::after { content: ""; position: absolute; top: 3px; left: 3px; width: 20px; height: 20px; border-radius: 50%; background: hsl(var(--hue),90%,60%); box-shadow: 0 0 calc(12px * var(--glow-intensity)) hsla(var(--hue),90%,60%,.6); transition: transform .2s ease; }
  .toggle[aria-pressed="true"]::after { transform: translateX(16px); }

  #hint { position: fixed; bottom: 10vh; right: 3vw; z-index: 12; opacity: 0; pointer-events: none; transition: opacity 1s ease; background: rgba(12,14,20,0.9); color: #c7d2fe; padding: .7rem 1rem; border-radius: 10px; font-size: .9rem; box-shadow: 0 0 calc(15px * var(--glow-intensity)) rgba(15,98,254,.3); }
  #projectToast { position: fixed; bottom: 4.5rem; left: 1.5rem; z-index: 12; display: none; background: rgba(10,12,18,0.85); border: 1px solid hsla(var(--hue),90%,60%,.4); color: #e0e7ff; font-size: .85rem; line-height: 1.4; padding: .75rem 1rem; border-radius: 12px; box-shadow: 0 0 calc(25px * var(--glow-intensity)) hsla(var(--hue),90%,60%,.3); }
  @keyframes fadeUp { 0% { opacity: 0; transform: translateY(4px); } 100% { opacity: 1; transform: translateY(0); } }
  @keyframes toastShimmer { 0%,100%{ box-shadow: 0 0 calc(20px * var(--glow-intensity)) hsla(var(--hue),90%,60%,.5);} 50%{ box-shadow: 0 0 calc(30px * var(--glow-intensity)) hsla(var(--hue),90%,65%,.8);} }
  #projectLink { position: fixed; bottom: 1.25rem; left: 1.25rem; z-index: 11; font-size: .85rem; color: #93c5fd; background: rgba(0,0,0,0.45); border: 1px solid rgba(147,197,253,0.25); border-radius: 9999px; padding: .4rem .8rem; text-decoration: none; }
  #ibmCta { position: fixed; bottom: .75rem; left: 1.25rem; z-index: 11; display: none; font-size: .85rem; color: #c7d2fe; background: rgba(10,12,18,0.85); border: 1px solid hsla(var(--hue),90%,60%,.35); border-radius: 10px; padding: .5rem .9rem; box-shadow: 0 0 calc(18px * var(--glow-intensity)) hsla(var(--hue),90%,60%,.25); }
  #ibmCta a { color: hsl(var(--hue),90%,70%); text-decoration: underline; }
  #ibmCta a:hover { text-decoration: none; color: hsl(var(--hue),90%,80%); }

  #overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 10; }
  #overlay.active { display: flex; }
  #overlay::before { content: ""; position: absolute; inset: 0; background: radial-gradient(circle at 50% 50%, rgba(20,30,50,0.55), rgba(0,0,0,0.92)); }
  #overlay::after { content: ""; position: absolute; inset: -20% -20%; background: conic-gradient(from 0deg, hsla(var(--hue),90%,60%,0.18), hsla(calc(var(--hue)+60),90%,55%,0.12), hsla(var(--hue),90%,60%,0.18)); filter: blur(24px); opacity:.9; animation: shimmer 3s ease infinite, auraPulse 2.5s ease-in-out infinite; }
  @keyframes shimmer { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  @keyframes auraPulse { 0%,100% { opacity:.8; } 50% { opacity:1; } }
  #overlay h1 { position: relative; color: white; font-size: 1.5rem; font-weight: 700; text-shadow: 0 0 20px hsla(var(--hue),90%,65%,.6); animation: textPulse 2.5s ease-in-out infinite; }
  @keyframes textPulse { 0%,100%{transform:scale(1);opacity:.9;}50%{transform:scale(1.05);opacity:1;} }
  #manifestParticles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events:none; }

  #errorToast { position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%); background-color: rgba(255, 50, 50, 0.85); color: white; padding: 0.8rem 1.2rem; border-radius: 8px; z-index: 100; opacity: 0; transition: opacity 0.5s ease; pointer-events: none; font-size: 0.9rem; box-shadow: 0 4px 15px rgba(200, 0, 0, 0.4); }
  #errorToast.visible { opacity: 1; pointer-events: auto; }
</style>
</head>
<body>

<canvas id="bg" aria-hidden="true"></canvas>
<canvas id="particles" aria-hidden="true"></canvas>

<iframe id="preview" class="hidden" title="Vibe Preview"></iframe>

<section id="editor" aria-label="Vibe code editor">
  <div id="editor-title">
    <span class="dot" style="background:#ff5f56" aria-hidden="true"></span>
    <span class="dot" style="background:#ffbd2f" aria-hidden="true"></span>
    <span class="dot" style="background:#27c93f" aria-hidden="true"></span>
    <span class="ml-2 opacity-80 text-sm select-none">/vibe-code.html</span>
    <span id="liteBadge">üí∏ Lite tier active ‚Äî zero-cost manifestation.</span>
  </div>
  <div id="codeHost"></div>
  <div id="actions">
    <button id="saveLocal" class="secondary-btn" type="button" aria-label="Save vibe to local file">Save File ‚§ì</button>
    <button id="copyCode" class="secondary-btn" type="button" aria-label="Copy vibe code to clipboard">Copy Code ‚ùê</button>
    <button id="manifest" class="btn" type="button" aria-label="Manifest your vibe">Manifest ‚ú®</button>
  </div>
</section>

<div id="overlay" aria-live="polite" aria-label="Manifesting overlay">
  <canvas id="manifestParticles"></canvas>
  <h1 id="overlay-status">‚ú® Manifesting your vibe...</h1>
</div>

<div id="orb" role="group" aria-label="Vibe controls">
  <div id="orbCore">
    <div id="orbLabel" aria-hidden="true">Vibe</div>
    <input id="hue" class="slider" type="range" min="0" max="360" value="220" aria-label="Hue slider" />
  </div>
</div>

<div id="dock" role="group" aria-label="Mini control dock">
  <div class="row"><div class="emo" title="Hue">üåà</div><input id="hue2" class="slider" type="range" min="0" max="360" value="220" aria-label="Hue slider duplicate" /></div>
  <div class="row"><div class="emo" title="Spark">‚ö°</div><input id="spark" class="slider" type="range" min="1" max="12" value="6" aria-label="Particle intensity" /></div>
  <div class="row"><div class="emo" title="Pulse">üí´</div><button id="pulse" class="toggle" aria-pressed="false" aria-label="Toggle pulsing"></button></div>
  <div class="row"><div class="emo" title="Zen">üßò</div><button id="zen" class="toggle" aria-pressed="false" aria-label="Toggle zen mode"></button></div>
  <div class="row"><div class="emo" title="Flow Speed">üåå</div><input id="flow" class="slider" type="range" min="0.1" max="3.0" value="1.0" step="0.1" aria-label="Background flow speed" /></div>
  <div class="row"><div class="emo" title="Particle Trail">‚ú®</div><button id="trail" class="toggle" aria-pressed="false" aria-label="Toggle particle trail"></button></div>
  <div class="row"><div class="emo" title="Glow Intensity">üîÜ</div><input id="glow" class="slider" type="range" min="0.5" max="2.5" value="1.0" step="0.1" aria-label="Glow intensity" /></div>
  <div class="row"><div class="emo" title="Ambient Sound">üéß</div><button id="sound" class="toggle" aria-pressed="false" aria-label="Toggle ambient sound"></button></div>
</div>

<button id="remix" class="btn" aria-label="Remix your vibe (return to editor)">Remix üé®</button>
<div id="hint" role="status" aria-live="polite">üí° Press <b>Remix üé®</b> (bottom-right) to edit your vibe again</div>
<div id="projectToast" role="status" aria-live="polite">
  üîÆ This vibe was manifested through an IBM Cloud Project.<br/>
  You can overwrite it forever by updating the ‚Äúvibe_code‚Äù variable in your project inputs.
</div>
<a id="projectLink" href="#" target="_blank" class="hidden" aria-label="Open IBM Cloud Project">‚òÅÔ∏è View IBM Cloud Project</a>
<section id="ibmCta" role="complementary" aria-label="Explore more Deployable Architectures from IBM Cloud">
  üí° See what other vibes IBM Cloud can manifest ‚Äî
  <a href="https://www.ibm.com/architectures/deployable-architectures" target="_blank" rel="noopener noreferrer">
    Explore more Deployable Architectures ‚Üí
  </a>
</section>
<div id="errorToast" role="alert"></div>

<script>
  // Pre-embedded guest/default endpoint (no prompt needed)
  let cloudFunctionUrl = "https://us-south.functions.appdomain.cloud/api/v1/web/guest/default/get-presigned-url";

  const { EditorView, basicSetup } = window["basicSetup"];
  const { EditorState } = window["@codemirror/state"];
  const { html } = window["@codemirror/lang-html"];

  let cmView;
  function buildEditor(doc){
    const parent = document.getElementById("codeHost");
    parent.innerHTML = "";
    cmView = new EditorView({
      parent,
      state: EditorState.create({ doc, extensions: [basicSetup, html()] })
    });
  }

  const starter = `<!-- üí∏ Running on IBM Cloud Lite tier ‚Äî this project will never incur cost. -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vibe Manifestation ‚Äî You Are Live</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root { --bg: #070016; --fg: #f5f7fb; --a1:#ff2bd6; --a2:#21f3ff; }
    html, body { height: 100%; }
    body { margin: 0; display: grid; place-items: center; gap: 18px; background:
      linear-gradient(135deg, rgba(10,0,24,.95), rgba(32,0,60,.95)); color: var(--fg);
      font-family: "IBM Plex Sans", system-ui; }
    .card { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.2);
      padding: 20px; border-radius: 16px; max-width: 920px; text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,.35); }
    h1 { margin: 0; font-size: clamp(1.6rem, 4vw, 3rem); }
    .btn { background: linear-gradient(90deg, var(--a1), var(--a2)); color: #070016;
      border: 0; border-radius: 12px; padding: .9rem 1.2rem; font-weight: 700; cursor: pointer; }
    code { background: rgba(255,255,255,.12); padding: .2rem .4rem; border-radius: 6px; }
    .muted { opacity: .86; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Paste. Tweak. Manifest.</h1>
    <p class="muted">Click <b>Manifest</b> in the Vibe IDE to publish this page as <code>index.html</code> into your IBM Cloud Object Storage bucket using a secure, presigned URL.</p>
    <p class="muted">Remix freely ‚Äî images, CSS, scripts ‚Äî then <b>Manifest</b> again to overwrite the live version. You are on the real internet.</p>
    <button class="btn" onclick="location.href='.'">Back to Vibe IDE</button>
  </div>
</body>
</html>`;

  // Minimal vibe bg loop
  let baseHue = 220; const bg = document.getElementById('bg'); const particles = document.getElementById('particles');
  let btx, iW, iH;
  function setupCanvases(){ btx=bg.getContext('2d'); iW=bg.width=particles.width=innerWidth; iH=bg.height=particles.height=innerHeight; }
  function draw(){ const t=performance.now(); const h1=(baseHue+Math.sin(t/4000)*40+360)%360,h2=(h1+120)%360;
    const g=btx.createLinearGradient(0,0,iW,iH); g.addColorStop(0,`hsl(${h1},75%,55%)`); g.addColorStop(1,`hsl(${h2},70%,40%)`);
    btx.fillStyle=g; btx.fillRect(0,0,iW,iH); requestAnimationFrame(draw); }

  // Save/Copy
  function saveLocal(){ const blob=new Blob([cmView.state.doc.toString()],{type:"text/html"}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="vibe-index.html"; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),5000); }
  async function copyCode(){ await navigator.clipboard.writeText(cmView.state.doc.toString()); document.getElementById('copyCode').classList.add('copied'); setTimeout(()=>document.getElementById('copyCode').classList.remove('copied'),1200); }

  async function manifest(){
    const overlay=document.getElementById('overlay'); const status=document.getElementById('overlay-status');
    overlay.classList.add('active'); status.textContent="‚ú® Requesting signed URL...";
    try{
      const res = await fetch(cloudFunctionUrl, {method:'GET'});
      if(!res.ok) throw new Error("Function error: "+res.status);
      const { signedUrl, publicUrl } = await res.json();
      status.textContent = "‚ú® Uploading to COS...";
      const put = await fetch(signedUrl, { method:'PUT', headers:{'Content-Type':'text/html'}, body: cmView.state.doc.toString() });
      if(!put.ok) throw new Error("PUT failed: "+put.status);
      status.textContent = "‚úÖ Manifested! Opening live page...";
      setTimeout(()=>window.open(publicUrl, "_blank"), 500);
    }catch(e){
      const t=document.getElementById('errorToast'); t.textContent=e.message||"Manifest failed"; t.classList.add('visible'); setTimeout(()=>t.classList.remove('visible'),2500);
    }finally{
      setTimeout(()=>document.getElementById('overlay').classList.remove('active'), 1200);
    }
  }

  function init(){
    setupCanvases(); draw();
    buildEditor(starter);
    document.getElementById('saveLocal').addEventListener('click', saveLocal);
    document.getElementById('copyCode').addEventListener('click', copyCode);
    document.getElementById('manifest').addEventListener('click', manifest);
  }
  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
