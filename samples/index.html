<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Vibe IDE ‚Äî Live Manifestation</title>
<style>
:root { --bg1:#0a0018; --bg2:#1a0036; --text:#f6f7fb; --green:#34D399; --orange:#F97316; }
* { box-sizing:border-box }
html,body { height:100% }
body {
  margin:0; color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, "IBM Plex Sans", sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2)); background-size:300% 300%;
  animation:shift 18s ease-in-out infinite alternate;
  display:flex; align-items:stretch; justify-content:center;
}
@keyframes shift { from{ background-position:0 0 } to { background-position:100% 100% } }
.wrap { width:min(1200px,96vw); margin:auto; padding:24px }
h1 { margin:0 0 8px; letter-spacing:-.02em }
.sub { color:#cbd5e1; margin:0 0 16px }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
textarea {
  width:100%; height:52vh; background:#0f172a; color:#e2e8f0; border:1px solid #334155; border-radius:12px; padding:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "IBM Plex Mono", monospace; line-height:1.5;
}
.preview { background:#0b1020; border:1px solid #334155; border-radius:12px; padding:12px; height:52vh; overflow:auto }
.row { display:flex; gap:12px; flex-wrap:wrap; margin:14px 0 4px }
.btn { appearance:none; border:1px solid #334155; background:#0f172a; color:#e2e8f0; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
.btn:hover { transform:translateY(-1px); box-shadow:0 8px 24px rgba(0,0,0,.25) }
.toast { position:fixed; left:50%; transform:translateX(-50%); bottom:20px; padding:10px 14px; border-radius:12px; color:#0b1020; display:none; font-weight:700 }
.toast.green { background: var(--green) }
.toast.orange { background: var(--orange) }
footer { margin-top:16px; color:#94a3b8; font-size:14px }
.banner {
  margin:18px 0; padding:12px 14px; border-radius:12px;
  background:rgba(255,255,255,.06); border:1px dashed rgba(255,255,255,.2);
}
.banner a { color:#f6f7fb; font-weight:700; text-decoration:underline; }
.small { font-size:12px; color:#9ca3af }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Vibe IDE ‚Äî Live Manifestation</h1>
    <p class="sub">Edit ‚Üí Manifest ‚ú® ‚Üí either <strong>push to COS (üí• drift)</strong> or <strong>push to Project (üß± staged)</strong>.</p>

    <div class="banner small">
      Self‚Äëaware promo zone: explore more <a href="https://www.ibm.com/architectures/deployable-architectures" target="_blank" rel="noopener">Deployable Architectures</a> and meet
      <a href="https://www.ibm.com/products/bob" target="_blank" rel="noopener">Project Bob</a>. We know it‚Äôs an ad. It‚Äôs also useful.
    </div>

    <div class="grid">
      <div>
        <textarea id="editor"><!doctype html>
<html><head><meta charset="utf-8"><title>New Vibe</title></head>
<body><h1>‚ú® Hello, new vibe!</h1><p>Edited via Vibe IDE.</p></body></html></textarea>
        <div class="row">
          <button class="btn" id="manifest">Manifest ‚ú®</button>
          <button class="btn" id="pushCos">Push to COS üí•</button>
          <button class="btn" id="pushProject">Push to Project üß±</button>
        </div>
      </div>
      <div class="preview"><iframe id="preview" style="width:100%;height:100%;border:0;background:#0b1020"></iframe></div>
    </div>

    <footer>
      Drift is a vibe ‚Äî reconcile responsibly. ‚Ä¢ <button class="btn" id="share">üèÖ claim vibe‚Äëcoding badge</button>
      <div class="small">Made with IBM Cloud + AI assistance. Console proof-of-life in DevTools.</div>
    </footer>
  </div>

  <div class="toast green" id="okCos">‚ú® Vibe manifested to COS</div>
  <div class="toast orange" id="okProj">üß± Project configuration staged</div>

<script>
const $ = (id)=>document.getElementById(id);
const show = (el) => { el.style.display='block'; setTimeout(()=> el.style.display='none', 3000); };

// Injected at deploy time (Terraform -> templatefile):
const PUSH_COS_URL = "${PUSH_COS_URL}";
const PUSH_PROJECT_URL = "${PUSH_PROJECT_URL}";

console.log('Connected to live Functions:', PUSH_COS_URL, PUSH_PROJECT_URL);

$('manifest').onclick = () => {
  const doc = $('editor').value;
  const iframe = $('preview');
  iframe.srcdoc = doc;
};

$('pushCos').onclick = async () => {
  const html = $('editor').value;
  try {
    const res = await fetch(PUSH_COS_URL, { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ html }) });
    if (res.ok) show($('okCos'));
  } catch (e) { console.error(e); }
};

$('pushProject').onclick = async () => {
  const html = $('editor').value;
  try {
    const res = await fetch(PUSH_PROJECT_URL, { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ html }) });
    if (res.ok) show($('okProj'));
  } catch (e) { console.error(e); }
};

$('share').onclick = () => {
  const text = encodeURIComponent('I just earned my Vibe‚ÄëCoding Badge on IBM Cloud ‚ú®');
  const url  = encodeURIComponent(window.location.href);
  window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&text=${text}`, '_blank');
};

// Initialize preview
$('manifest').click();
</script>
</body>
</html>
